## 03. 데이터 파이프라인 패턴(일반적)

### ETL과 ELT

- ETL, ELT는 데이터 웨어하우징 및 비즈니스 인텔리전스에서 널리 사용되는 패턴
- 두 패턴 모두 데이터 웨어하우스에 데이터를 공급하고 분석가가 유용하게 쓸 수 있게 하는 데이터 처리에 대한 접근 방식

**각 단계 별 설명**

- 추출(Extract):
    - 로드 및 변환을 준비하기 위해 다양한 소스에서 데이터를 수집
- 로드(Load):
    - 원본 데이터(ELT의 경우) 또는 완전히 변환된 데이터(ETL의 경우)를 최종 대상으로 가져옴, 어느 쪽이든 최종 결과는 데이터 웨어하우스, 데이터 레이크 또는 기타 대상에 데이터를 로드
- 변환(Transform):
    - 파이프라인이 제공하는 모든 사용 사례에 유용하게 쓸 수 있게 각 소스 시스템의 원본 데이터를 결합하고 형식을 지정하는 단계

> 결국 ETL, ELT의 차이는 어떤 형태로 로드하냐에 따라 달라진다!

### ETL을 넘어선 ELT의 등장

**표준인 ETL에서 ELT라는 추가적인 선택지가 등장한 이유**

- 클라우드 기반으로 하는 최신 데이터 웨어하우스 이전에는 방대한 양의 원본 데이터를 로드하고 사용 가능한 데이터로 변환하는 데 필요한 스토리지나 컴퓨팅 자원이 모두 모여있는 데이터 웨어하우스에 액세스할 수 없었다.
- 옛날 데이터 웨어하우스는 트랙잭션 사용 사례에서 잘 작동하는 행 기반 데이터베이스였어서 분석에서 흔히 볼 수 있는 대용량 쿼리에는 적합하지 않음, 그래서 쿼리를 하기 전에 별도의 시스템에서 변환 진행

클라우드가 발전함에 따라 ETL → ELT가 가능해졌다.

- 클라우드 데이터 웨어하우스는 비용 효율적인 방식으로 대규모 데이터세트에 대한 대량 변환을 저장하고 실행할 수 있는 확장성이 뛰어난 열 기반 데이터베이스를 기반으로 함 → **클라우드에서 대용량 변환 작업 가능!**
- 결국 데이터를 추출하고 파이프라인을 완료하는 데 필요한 변환을 수행할 수 있는 데이터 웨어하우스에 로드하는 것에 집중이 가능

**행 기반 데이터 웨어하우스 vs 열 기반 데이터 웨어하우스**

- 행 기반 데이터 웨어하우스

<img width="443" alt="스크린샷 2024-08-04 오후 9 23 40" src="https://github.com/user-attachments/assets/aa7e03ca-b434-4096-a9d9-5d7c5941e0c8">


MySQL, Postgres은 행 기반 데이터베이스로, 데이터베이스의 각 행은 각 레코드의 크기에 따라 하나 이상의 블-록으로 디스크에 함께 저장된다.

레코드가 단일 블록보다 작거나 블록 크기로 깔끔하게 나눌 수 없는 경우 일부 디스크 공간을 사용하지 않은 상태로 남긴다.

저장을 위해 MySQL 데이터베이스를 활용할 경우 이커머스 웹 애플리케이션과 같은 OLTP(온라인 트랜잭션 처리) 데이터베이스 사용 사례를 생각해보자.

- 웹 앱은 주문 확인 페이지의 주문 세부 정보와 같이 각 레코드의 여러 값을 포함하는 데이터베이스에서 읽기 및 쓰기 요청
- 또한 한 번에 하나의 주문만 쿼리하거나 업데이트할 가능성이 높음
- 따라서 응용 프로그램이 필요로 하는 데이터가 디스크에서 가깝게 저장되고 한 번에 쿼리되는 데이터의 양이 적기 때문에 행 기반 저장소가 최적

> 정리하자면 이커머스 웹 애플리케이션 같은 경우 사용자가 주문 확인 페이지를 열면 해당 주문의 전체 정보를 한 번에 읽어와야 하는데 이때 행 기반 데이터 웨어하우스를 사용하면 한 번의 조회(쿼리)로 전체 정보(행 내용)를 가져오기 때문에 효율적이다.

- 열 기반 데이터 웨어하우스

<img width="443" alt="스크린샷 2024-08-04 오후 10 07 48" src="https://github.com/user-attachments/assets/fa5c8b7e-b919-4dfb-8a45-b9d6655a175d">


이커머스 웹 애플리케이션과 달리 분석에서는 적은 양의 데이터를 자주 읽고 쓰는 경우보다는 많은 양의 데이터를 드물게 읽고 쓰는 경우가 많다. 또한, 분석 쿼리가 테이블에 있는 특정 열의 대부분 또는 전부보다는 단일 열을 필요로 할 가능성이 더 크다. 

> 즉, 특정 열 데이터 집합을 조회할 때 성능이 뛰어나(추가 메모리 할당 x) OALP(온라인 분석 처리)에 유리하다. 

### EtLT 하위 패턴

비즈니스 논리 또는 데이터 모델링을 포함하는 변환 대신 이러한 유형의 변환은 범위가 더 제한된다. 이것을 EtLT라고 한다. 

- 테이블에서 레코드 중복 제거
- URL 파라미터를 개별 구성요소로 구문 분석
- 민감한 데이터 마스킹 또는 난독화

법적 또는 보안상의 이유로 파이프라인 초기에 필요한 경우가 존재한다. 그래서 위와 같이 기본 변환을 수행하는 것이다. 

### 데이터 제품 및 머신러닝을 위한 ELT

데이터 제품의 일반적인 예는 다음과 같다.

- 비디오 스트리밍 홈 화면을 구동하는 콘텐츠 추천 엔진
- 전자상거래 웹사이트의 개인화된 검색 엔진
- 사용자가 생성한 레스토랑 리뷰에 대한 감성 분석을 수행하는 애플리케이션

위의 예를 구현하기 위해서는 다양한 소스 시스템에서의 데이터가 필요하며 모델에서 사용할 수 있도록 일정 수준의 변환을 거칠 수 있다. 

이때 ELT와 같은 패턴은 위의 요구사항에 매우 적합하다.

> **기존에 데이터 엔지니어링에 관해서 지식이 짧았을 때는 ETL이라는 표현을 많이 썼는데 클라우드가 발전함에따라 ETL보다는 ELT 방식을 써야겠다는 생각이 든다.**

머신러닝 파이프라인도 마찬가지로 ELT와 유사한 패턴을 따른다. 

> **현재 [인턴](https://wwns1411.tistory.com/11)에서 LSTM(ML) 파이프라인을 구축 중인데 ELT 패턴을 따르도록 수정을 해야겠다.**
